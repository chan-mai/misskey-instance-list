generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "cockroachdb"
}

enum SuspensionState {
  none
  suspended
  gone
}

enum ExcludedHostSource {
  joinmisskey
  manual
  system
}

model Instance {
  id               String           @id
  node_name        String?
  users_count      Int?             @default(0)
  notes_count      Int?             @default(0)
  version          String?
  is_alive         Boolean          @default(false)
  created_at       DateTime         @default(now())
  last_updated     DateTime?        @updatedAt
  last_check_at    DateTime?
  banner_url       String?
  icon_url         String?
  suspension_state SuspensionState  @default(none)
  recommendation_score Float?
  open_registrations Boolean?
  email_required     Boolean?
  repository_url   String?
  language         String?
  repository       Repository?      @relation(fields: [repository_url], references: [url])

  @@map("instances")
  @@index([repository_url])
  @@index([language])
}

model Repository {
  url         String   @id
  name        String?
  description String?
  updated_at  DateTime @updatedAt
  created_at  DateTime @default(now())
  instances   Instance[]

  @@map("repositories")
}

model ExcludedHost {
  domain     String             @id
  reason     String?
  source     ExcludedHostSource @default(system)
  created_at DateTime           @default(now())

  @@map("excluded_hosts")
}
